<!-- header start -->
<app-header-four></app-header-four>
<!-- header end -->

<main>
  <!-- breadcrumb area start -->
  <div style="background-color: #EFF1F5;">
    <app-breadcrumb-one title="Ödeme Sayfası" subtitle="Ödeme"></app-breadcrumb-one>
  </div>
  <!-- breadcrumb area end -->

  <!-- checkout area start -->
  <section class="tp-checkout-area pb-120" style="background-color: #EFF1F5;">
    <div class="container">
      <div *ngIf="cartService.getCartProducts().length === 0;else checkoutBlock" class="text-center pt-50">
        <h3 class="py-2">Seçili ürün bulunmuyor</h3>
        <a routerLink="/shop" class="tp-checkout-btn">
          Alışverişe dön
        </a>
      </div>

      <ng-template #checkoutBlock>
        <div class="row">
          <div class="col-xl-7 col-lg-7">
            <div class="tp-checkout-verify">
              <div class="tp-checkout-verify-item">
                <p class="tp-checkout-verify-reveal">Müşteri Girişi
                  <button (click)="handleOpenLogin()" type="button" class="tp-checkout-login-form-reveal-btn">Giriş Yap
                  </button>
                </p>
                <div *ngIf="isOpenLogin" id="tpReturnCustomerLoginForm" class="tp-return-customer">
                  <app-login-form></app-login-form>
                </div>
              </div>
              <!-- <div class="tp-checkout-verify-item">
                <p class="tp-checkout-verify-reveal">Have a coupon?
                  <button (click)="handleOpenCoupon()" type="button" class="tp-checkout-coupon-form-reveal-btn">Click
                    here to enter your code
                  </button>
                </p>
                <div *ngIf="isOpenCoupon" id="tpCheckoutCouponForm" class="tp-return-customer">
                  <form (ngSubmit)="handleCouponSubmit()">
                    <div class="tp-return-customer-input">
                      <label>Coupon Code :</label>
                      <input type="text" placeholder="Coupon" [(ngModel)]="couponCode" name="couponCode">
                    </div>
                    <button type="submit" class="tp-return-customer-btn tp-checkout-btn">
                      Apply
                    </button>
                  </form>
                </div>
              </div> -->
            </div>
          </div>

          <form [formGroup]="checkoutForm" (ngSubmit)="onSubmit()">
            <div class="row">
              <div class="col-lg-7">
                <div class="tp-checkout-bill-area">
                  <h3 class="tp-checkout-bill-title">Ödeme Detayları</h3>
                  <div class="tp-checkout-bill-form">
                    <div class="tp-checkout-bill-inner">
                      <div class="row">
                        <div class="col-md-6">
                          <div class="tp-checkout-input">
                            <label>İsim <span>*</span></label>
                            <input type="text" placeholder="İsminiz" name="firstName" formControlName="firstName">
                            <!-- error msg start -->
                            <span *ngIf="firstName?.hasError('required') && (firstName?.touched ||formSubmitted)"
                              class="text-danger">
                              İsim zorunludur
                            </span>
                            <!-- error msg end -->
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="tp-checkout-input">
                            <label>Soyisim <span>*</span></label>
                            <input type="text" placeholder="Soyisim" name="lastName" formControlName="lastName">
                            <!-- error msg start -->
                            <span *ngIf="lastName?.hasError('required') && (lastName?.touched ||formSubmitted)"
                              class="text-danger">
                              Soyisim zorunludur
                            </span>
                            <!-- error msg end -->
                          </div>
                        </div>
                        <div class="col-md-12">
                          <div class="tp-checkout-input">
                            <label>Şirket Adı (opsiyonel)</label>
                            <input type="text" placeholder="Örnek LTD." name="company" formControlName="company">
                          </div>
                        </div>
                        <div class="col-md-12">
                          <div class="tp-checkout-input">
                            <label>Ülke</label>
                            <input type="text" placeholder="Türkiye (TUR)" name="country" formControlName="country">
                            <!-- error msg start -->
                            <span *ngIf="country?.hasError('required') && (country?.touched ||formSubmitted)" class="text-danger">
                              Ülke zorunludur
                            </span>
                            <!-- error msg end -->
                          </div>
                        </div>
                        <div class="col-md-12">
                          <div class="tp-checkout-input">
                            <label>Adres</label>
                            <input type="text" placeholder="Apartman Sokak Cadde Bulvar No" name="address"
                              formControlName="address">
                            <!-- error msg start -->
                            <span *ngIf="address?.hasError('required') && (address?.touched ||formSubmitted)" class="text-danger">
                              Adres zorunludur
                            </span>
                            <!-- error msg end -->
                          </div>
                          <!-- <div class="tp-checkout-input">
                            <input type="text" placeholder="Adres Devam">
                          </div> -->
                        </div>
                        <div class="col-md-12">
                          <div class="tp-checkout-input">
                            <label>İl / İlçe</label>
                            <input type="text" placeholder="İl / İlçe" name="city" formControlName="city">
                            <!-- error msg start -->
                            <span *ngIf="city?.hasError('required') && (city?.touched ||formSubmitted)" class="text-danger">
                                İl / İlçe zorunludur
                            </span>
                            <!-- error msg end -->
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="tp-checkout-input">
                            <label>Kıta</label>
                            <app-nice-select [options]="countrySelectOptions" name="Select Country" [defaultCurrent]="0"
                              (onChange)="changeHandler($event)" placeholder="Select Country">
                            </app-nice-select>
                            <!-- error msg start -->
                            <span *ngIf="state?.hasError('required') && (state?.touched ||formSubmitted)" class="text-danger">
                              Kıta zorunludur
                            </span>
                            <!-- error msg end -->
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="tp-checkout-input">
                            <label>Posta Kodu</label>
                            <input type="text" placeholder="Posta Kodu" name="zipCode" formControlName="zipCode">
                            <!-- error msg start -->
                            <span *ngIf="zipCode?.hasError('required') && (zipCode?.touched ||formSubmitted)" class="text-danger">
                              Posta Kodu zorunludur
                            </span>
                            <!-- error msg end -->
                          </div>
                        </div>
                        <div class="col-md-12">
                          <div class="tp-checkout-input">
                            <label>Telefon <span>*</span></label>
                            <input type="text" placeholder="Telefon" name="phone" formControlName="phone">
                            <!-- error msg start -->
                            <span *ngIf="phone?.hasError('required') && (phone?.touched ||formSubmitted)" class="text-danger">
                              Telefon zorunludur
                            </span>
                            <!-- error msg end -->
                          </div>
                        </div>
                        <div class="col-md-12">
                          <div class="tp-checkout-input">
                            <label>Email<span>*</span></label>
                            <input type="email" placeholder="Email" name="email" formControlName="email">
                            <!-- error msg start -->
                            <span
                              *ngIf="(email?.hasError('required') && email?.touched) || (email?.hasError('email') && email?.dirty) || (formSubmitted && !email?.value)"
                              class="text-danger"
                              >
                              Email zorunludur
                            </span>
                            <!-- error msg end -->
                          </div>
                        </div>
                        <div class="col-md-12">
                          <div class="tp-checkout-input">
                            <label>Sipariş Notu (opsiyonel)</label>
                            <textarea name="orderNote" formControlName="orderNote"
                              placeholder="Siparişinizle ilgili notlarınızı iletebilirsiniz"></textarea>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-lg-5">
                <!-- checkout place order -->
                <div class="tp-checkout-place white-bg">
                  <h3 class="tp-checkout-place-title">Siparişiniz</h3>

                  <div class="tp-order-info-list">
                    <ul>

                      <!-- header -->
                      <li class="tp-order-info-list-header">
                        <h4>Ürün</h4>
                        <h4>Fiyat</h4>
                      </li>

                      <!-- item list -->
                      <li *ngFor="let item of cartService.getCartProducts()" class="tp-order-info-list-desc">
                        <p>{{item.title}} <span> x {{item.orderQuantity}}</span></p>
                        <span *ngIf="item.discount > 0; else noDiscount">
                          {{ (item.price - (item.price * item.discount / 100)).toFixed(2) }} TL
                        </span>
                        <ng-template #noDiscount>
                          <span>{{item.price.toFixed(2)}} TL</span>
                        </ng-template>
                      </li>

                      <!-- subtotal -->
                      <li class="tp-order-info-list-subtotal">
                        <span>Ara Toplam</span>
                        <span>{{cartService.totalPriceQuantity().total.toFixed(2)}} TL</span>
                      </li>

                      <!-- shipping -->
                      <li class="tp-order-info-list-shipping">
                        <span>Kargolama</span>
                        <div class="tp-order-info-list-shipping-item d-flex flex-column align-items-end">
                          <span>
                            <input id="flat_rate" type="radio" name="shipping">
                            <label (click)="handleShippingCost(20)" for="flat_rate">Hızlı Kargo
                              <span>20.00 TL</span></label>
                          </span>
                          <!-- <span>
                            <input id="local_pickup" type="radio" name="shipping">
                            <label (click)="handleShippingCost(25)" for="local_pickup">Local pickup:
                              <span>$25.00</span></label>
                          </span>
                          <span>
                            <input id="free_shipping" type="radio" name="shipping">
                            <label (click)="handleShippingCost('free')" for="free_shipping">Free shipping</label>
                          </span> -->
                        </div>
                      </li>

                      <!-- total -->
                      <li class="tp-order-info-list-total">
                        <span>Toplam</span>
                        <span>
                          {{(cartService.totalPriceQuantity().total + shipCost).toFixed(2)}} TL
                        </span>
                      </li>
                    </ul>
                  </div>
                  <!-- <div class="tp-checkout-payment">
                    <div class="tp-checkout-payment-item">
                      <input type="radio" id="back_transfer" name="payment">
                      <label (click)="handlePayment('bank')" for="back_transfer"
                        data-bs-toggle="direct-bank-transfer">Direct Bank Transfer</label>
                      <div *ngIf="payment_name === 'bank'" class="tp-checkout-payment-desc direct-bank-transfer">
                        <p>Make your payment directly into our bank account. Please use your Order ID as the payment
                          reference. Your order will not be shipped until the funds have cleared in our account.</p>
                      </div>
                    </div>
                    <div class="tp-checkout-payment-item">
                      <input type="radio" id="cheque_payment" name="payment">
                      <label (click)="handlePayment('cheque')" for="cheque_payment">Cheque Payment</label>
                      <div *ngIf="payment_name === 'cheque'" class="tp-checkout-payment-desc cheque-payment">
                        <p>Make your payment directly into our bank account. Please use your Order ID as the payment
                          reference. Your order will not be shipped until the funds have cleared in our account.</p>
                      </div>
                    </div>
                  </div> -->
                  <div class="tp-checkout-btn-wrapper">
                    <button type="submit" class="tp-checkout-btn w-100">Sipariş Ver</button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </ng-template>
    </div>
  </section>
  <!-- checkout area end -->
</main>


<!-- footer start -->
<app-footer-two></app-footer-two>
<!-- footer end -->
